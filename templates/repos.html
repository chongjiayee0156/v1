<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ username }}'s Pinned Repositories</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <!-- React + Babel -->
  <script
    src="https://unpkg.com/react@18/umd/react.development.js"
    crossorigin
  ></script>
  <script
    src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    crossorigin
  ></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    function RepoCard({ repo }) {
      return (
        <div className="bg-gray-50 p-4 rounded-md shadow-sm mb-4 border">
          <h2 className="text-xl font-bold text-blue-700">{repo.name}</h2>
          <a href={repo.url} target="_blank" className="text-blue-500 underline">Visit Repository</a>
          <p className="text-gray-600 mt-1">{repo.description || "No description provided"}</p>
          <div className="text-sm text-gray-500 mt-2">
            ‚≠ê {repo.stargazerCount} | üç¥ {repo.forkCount} | üíª {repo.primaryLanguage?.name || "N/A"}
          </div>
        </div>
      );
    }

    function RepoList({ repos }) {
      return (
        <div>
          <h1 className="text-2xl font-semibold mb-4">React Rendered Repositories</h1>
          {repos.map((edge, idx) => (
            <RepoCard key={idx} repo={edge.node} />
          ))}
        </div>
      );
    }

    document.addEventListener("DOMContentLoaded", () => {
      ReactDOM.createRoot(document.getElementById("react-root")).render(
        <RepoList repos={reposJSON} />
      );
    });
  </script>
  <body class="bg-gray-100 text-gray-800 font-sans">
    <div class="container mx-auto px-4 py-10 max-w-5xl">
      <h1 class="text-4xl font-bold mb-2">
        Pinned Repositories of {{ username }}
      </h1>
      <a href="/" class="text-blue-600 hover:underline mb-6 inline-block"
        >‚Üê Back to Search</a
      >

      <!-- Tabs -->
      <div class="flex space-x-4 border-b mb-6">
        <button
          class="tab-button text-gray-600 border-b-2 pb-2"
          onclick="showTab('repos')"
        >
          Pinned Repositories
        </button>
        <button
          class="tab-button text-gray-600 border-b-2 pb-2"
          onclick="showTab('json')"
        >
          JSON
        </button>
        <button
          class="tab-button text-gray-600 border-b-2 pb-2"
          onclick="showTab('code')"
        >
          Code
        </button>
      </div>

      <!-- Repos Tab -->
      <div id="tab-repos" class="tab-content">
        {% if repos %}
        <div class="space-y-6">
          {% for repo_edge in repos %} {% set repo = repo_edge.node %}
          <div
            class="bg-white p-6 rounded-xl shadow-md transition hover:shadow-lg"
          >
            <div class="flex justify-between items-start">
              <div>
                <h2 class="text-2xl font-semibold">{{ repo.name }}</h2>
                <p class="mt-2 text-gray-600">
                  {{ repo.description or 'No description' }}
                </p>
              </div>
              <a
                href="{{ repo.url }}"
                target="_blank"
                class="text-blue-500 hover:underline font-medium"
                >View ‚Üó</a
              >
            </div>
            <div class="flex justify-between text-sm text-gray-500 mt-4">
              <span
                >‚≠ê {{ repo.stargazerCount }} | üç¥ {{ repo.forkCount }}</span
              >
              <span
                >üíª {{ repo.primaryLanguage.name if repo.primaryLanguage else
                'N/A' }}</span
              >
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-600">No pinned repositories found.</p>
        {% endif %}
      </div>

      <!-- JSON Tab -->
      <div id="tab-json" class="tab-content hidden relative">
        <div
          class="bg-gray-900 text-gray-100 rounded-xl shadow-md p-6 text-sm font-mono overflow-x-auto whitespace-pre h-[500px] relative"
        >
          <pre id="json-output" class="pr-10"></pre>
          <!-- Copy button -->
          <button
            onclick="copyReposJSON()"
            class="absolute bottom-4 right-4 bg-blue-600 text-white px-3 py-1.5 rounded-md text-xs shadow hover:bg-blue-700 focus:outline-none"
          >
            Copy JSON
          </button>
          <span
            id="copy-message"
            class="absolute bottom-4 right-28 text-green-400 text-xs hidden"
            >Copied!</span
          >
        </div>
      </div>

      <!-- Code Tab (Display JSX Code + JSON Data) -->
      <div id="tab-code" class="tab-content hidden">
        <div
          class="bg-gray-900 text-gray-100 rounded-xl shadow-md p-6 text-sm font-mono overflow-x-auto whitespace-pre h-[500px] relative"
        >
          <pre id="code-output" class="pr-10"></pre>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script id="repos-json" type="application/json">
      {{ repos | tojson }}
    </script>

    <script>
      const reposJSON = JSON.parse(
        document.getElementById("repos-json").textContent
      );

      document.getElementById("json-output").textContent = JSON.stringify(
        reposJSON,
        null,
        2
      );

      function copyReposJSON() {
        navigator.clipboard
          .writeText(JSON.stringify(reposJSON, null, 2))
          .then(() => {
            const msg = document.getElementById("copy-message");
            msg.classList.remove("hidden");
            setTimeout(() => msg.classList.add("hidden"), 2000);
          });
      }

      function showTab(tab) {
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => el.classList.add("hidden"));
        document.getElementById("tab-" + tab).classList.remove("hidden");

        document.querySelectorAll(".tab-button").forEach((btn) => {
          btn.classList.remove("text-blue-600", "border-blue-500");
        });
        event.target.classList.add("text-blue-600", "border-blue-500");
      }

      document.addEventListener("DOMContentLoaded", () => {
        showTab("repos");

        // JSX code and JSON data template to display in the Code Tab
        const jsxCode = `
function RepoCard({ repo }) {
  return (
    <div className="bg-gray-50 p-4 rounded-md shadow-sm mb-4 border">
      <h2 className="text-xl font-bold text-blue-700">{repo.name}</h2>
      <a href={repo.url} target="_blank" className="text-blue-500 underline">Visit Repository</a>
      <p className="text-gray-600 mt-1">{repo.description || "No description provided"}</p>
      <div className="text-sm text-gray-500 mt-2">
        ‚≠ê {repo.stargazerCount} | üç¥ {repo.forkCount} | üíª {repo.primaryLanguage?.name || "N/A"}
      </div>
    </div>
  );
}

function RepoList({ repos }) {
  return (
    <div>
      <h1 className="text-2xl font-semibold mb-4">React Rendered Repositories</h1>
      {repos.map((edge, idx) => (
        <RepoCard key={idx} repo={edge.node} />
      ))}
    </div>
  );
}
        `;

        const jsonData = JSON.stringify(reposJSON, null, 2);

        const codeTemplate = `// JSX Code to render repositories UI
const reposJSON = ${jsonData};

function RepoCard({ repo }) {
  return (
    <div className="bg-gray-50 p-4 rounded-md shadow-sm mb-4 border">
      <h2 className="text-xl font-bold text-blue-700">{repo.name}</h2>
      <a href={repo.url} target="_blank" className="text-blue-500 underline">Visit Repository</a>
      <p className="text-gray-600 mt-1">{repo.description || "No description provided"}</p>
      <div className="text-sm text-gray-500 mt-2">
        ‚≠ê {repo.stargazerCount} | üç¥ {repo.forkCount} | üíª {repo.primaryLanguage?.name || "N/A"}
      </div>
    </div>
  );
}

function RepoList({ repos }) {
  return (
    <div>
      <h1 className="text-2xl font-semibold mb-4">React Rendered Repositories</h1>
      {repos.map((edge, idx) => (
        <RepoCard key={idx} repo={edge.node} />
      ))}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('react-root')).render(
  <RepoList repos={reposJSON} />
);
        `;

        document.getElementById("code-output").textContent = codeTemplate;
      });
    </script>
  </body>
</html>
